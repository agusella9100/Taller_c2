Version 4
SHEET 1 6000 2436
WIRE 96 -32 -240 -32
WIRE 320 -32 96 -32
WIRE 640 -32 320 -32
WIRE 784 -32 736 -32
WIRE 1024 -32 1024 -192
WIRE 1024 -32 784 -32
WIRE 1072 -32 1024 -32
WIRE 1232 -32 1232 -192
WIRE 1232 -32 1152 -32
WIRE 1472 -32 1232 -32
WIRE 1840 -32 1472 -32
WIRE 2000 -32 1840 -32
WIRE 1472 16 1472 -32
WIRE 208 96 160 96
WIRE 256 96 208 96
WIRE 1472 112 1472 96
WIRE 1472 112 1392 112
WIRE 1776 112 1712 112
WIRE 688 128 688 32
WIRE 784 128 784 -32
WIRE 1472 144 1472 112
WIRE -240 176 -240 -32
WIRE 96 176 96 144
WIRE 208 176 208 96
WIRE 208 176 96 176
WIRE 320 208 320 144
WIRE 736 208 736 192
WIRE 736 208 320 208
WIRE 928 208 736 208
WIRE 96 304 96 176
WIRE 320 304 320 208
WIRE 1840 304 1840 -32
WIRE 2000 304 2000 -32
WIRE 1472 320 1472 224
WIRE 1600 320 1472 320
WIRE 1712 320 1712 112
WIRE 32 352 -32 352
WIRE 1392 352 1392 112
WIRE 1392 352 384 352
WIRE -32 400 -32 352
WIRE 1712 400 1648 400
WIRE 1472 416 1472 320
WIRE 96 432 96 400
WIRE 208 432 96 432
WIRE 320 432 320 400
WIRE 320 432 208 432
WIRE 208 464 208 432
WIRE 1712 496 1712 400
WIRE -240 576 -240 256
WIRE -32 576 -32 480
WIRE -32 576 -240 576
WIRE 208 576 208 544
WIRE 208 576 -32 576
WIRE 1472 576 1472 496
WIRE 1472 576 208 576
WIRE 1600 576 1600 416
WIRE 1600 576 1472 576
WIRE 1712 576 1600 576
WIRE 1840 576 1840 384
WIRE 1840 576 1712 576
WIRE 2000 576 2000 368
WIRE 2000 576 1840 576
WIRE 976 1312 848 1312
WIRE 1104 1312 1056 1312
WIRE 1232 1312 1104 1312
WIRE 1344 1328 1296 1328
WIRE 1424 1328 1344 1328
WIRE 1552 1328 1504 1328
WIRE 1648 1328 1552 1328
WIRE 1232 1344 1200 1344
WIRE 1776 1344 1712 1344
WIRE 1824 1344 1776 1344
WIRE 2880 1344 2880 1328
WIRE 1104 1360 1104 1312
WIRE 1648 1360 1616 1360
WIRE 2432 1360 2384 1360
WIRE 2576 1360 2512 1360
WIRE 2576 1376 2576 1360
WIRE 1200 1408 1200 1344
WIRE 1344 1408 1344 1328
WIRE 1344 1408 1200 1408
WIRE 2256 1424 2160 1424
WIRE 2384 1424 2384 1360
WIRE 2384 1424 2336 1424
WIRE 2432 1424 2384 1424
WIRE 2880 1440 2880 1344
WIRE 1616 1456 1616 1360
WIRE 1664 1456 1616 1456
WIRE 1776 1456 1776 1344
WIRE 1776 1456 1744 1456
WIRE 2432 1472 2432 1424
WIRE 2512 1472 2432 1472
WIRE 2656 1488 2576 1488
WIRE 2704 1488 2656 1488
WIRE 2816 1488 2784 1488
WIRE 976 1504 848 1504
WIRE 1104 1504 1056 1504
WIRE 1232 1504 1104 1504
WIRE 2512 1504 2432 1504
WIRE 1360 1520 1296 1520
WIRE 1424 1520 1360 1520
WIRE 1552 1520 1552 1328
WIRE 1552 1520 1504 1520
WIRE 1616 1520 1616 1456
WIRE 1104 1536 1104 1504
WIRE 1232 1536 1200 1536
WIRE 2256 1584 2160 1584
WIRE 2432 1584 2432 1504
WIRE 2432 1584 2336 1584
WIRE 2528 1584 2432 1584
WIRE 2656 1584 2656 1488
WIRE 2656 1584 2608 1584
WIRE 2880 1584 2880 1536
WIRE 1200 1600 1200 1536
WIRE 1360 1600 1360 1520
WIRE 1360 1600 1200 1600
WIRE 2880 1696 2880 1664
WIRE 1776 1888 1520 1888
WIRE 2752 1904 2752 1856
WIRE 2928 1904 2928 1856
WIRE 1376 2016 1280 2016
WIRE 1520 2016 1520 1968
WIRE 1520 2016 1456 2016
WIRE 1600 2016 1520 2016
WIRE 2752 2048 2752 1984
WIRE 2928 2048 2928 1984
WIRE 1600 2064 1600 2016
WIRE 1632 2064 1600 2064
WIRE 1776 2080 1776 1888
WIRE 1776 2080 1696 2080
WIRE 1824 2080 1776 2080
WIRE 1632 2096 1600 2096
WIRE 1376 2144 1280 2144
WIRE 1520 2144 1456 2144
WIRE 1600 2144 1600 2096
WIRE 1600 2144 1520 2144
WIRE 1520 2256 1520 2144
WIRE 1520 2416 1520 2336
WIRE 1568 2416 1520 2416
FLAG 208 576 0
FLAG 1840 -32 Vo
FLAG -32 352 Vref
FLAG -240 -32 VIN
FLAG 1392 112 Vf
FLAG 1776 192 0
FLAG 1232 -192 Vs-
FLAG 1024 -192 Vs+
FLAG 1280 2016 Vs-
FLAG 1280 2144 Vs+
FLAG 1568 2416 0
FLAG 1824 2080 VS
FLAG 1104 1440 0
FLAG 1104 1616 0
FLAG 1616 1600 0
FLAG 848 1312 Vref
FLAG 848 1504 Vf
FLAG 1824 1344 Vref-c
FLAG 2576 1376 0
FLAG 2880 1696 0
FLAG 2160 1584 Vref-c
FLAG 2160 1424 VS
FLAG 2880 1344 Verror
FLAG 928 208 Verror
FLAG 2752 2048 0
FLAG 2752 1856 V+
FLAG 2928 1856 V-
FLAG 2928 2048 0
DATAFLAG 1680 -32 ""
DATAFLAG 624 352 ""
SYMBOL pnp 160 144 R180
SYMATTR InstName Q1
SYMATTR Value BC557C
SYMBOL pnp 256 144 M180
SYMATTR InstName Q2
SYMATTR Value BC557C
SYMBOL npn 32 304 R0
SYMATTR InstName Q3
SYMATTR Value BC547C
SYMBOL npn 384 304 M0
SYMATTR InstName Q4
SYMATTR Value BC547C
SYMBOL res 192 448 R0
SYMATTR InstName R1
SYMATTR Value 500
SYMBOL pnp 736 32 M270
SYMATTR InstName Q5
SYMATTR Value 2N4403
SYMBOL npn 688 192 R270
SYMATTR InstName Q6
SYMATTR Value 2N4401
SYMBOL res 1456 0 R0
WINDOW 0 44 33 Left 2
WINDOW 3 38 73 Left 2
SYMATTR InstName R5
SYMATTR Value 10.47k
SYMBOL res 1456 128 R0
SYMATTR InstName R6
SYMATTR Value 3.3k
SYMBOL res 1824 288 R0
SYMATTR InstName RL
SYMATTR Value {RL}
SYMBOL voltage -32 384 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 0
SYMATTR Value2 AC {VREFAC}
SYMATTR InstName V1
SYMATTR Value {VREFDC}
SYMBOL voltage -240 160 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 0
SYMATTR Value2 AC {VINAC}
SYMATTR InstName VIN
SYMATTR Value {VINDC}
SYMBOL res 80 -48 R0
SYMATTR InstName R8
SYMATTR Value {RE}
SYMBOL res 304 -48 R0
SYMATTR InstName R9
SYMATTR Value {RE}
SYMBOL cap 1984 304 R0
SYMATTR InstName C3
SYMATTR Value 1µ
SYMBOL res 1456 400 R0
SYMATTR InstName R88
SYMATTR Value 2.7k
SYMBOL nmos 1648 320 M0
SYMATTR InstName M1
SYMATTR Value IPT004N03L
SYMBOL res 1696 480 R0
SYMATTR InstName R11
SYMATTR Value 10k
SYMBOL res 1696 304 R0
SYMATTR InstName R99
SYMATTR Value 10k
SYMBOL voltage 1776 96 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value {Vllave}
SYMBOL res 1168 -48 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 0.1
SYMBOL res 1360 2160 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R3
SYMATTR Value {Rvs}
SYMBOL res 1472 2000 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value {Rvs}
SYMBOL res 1536 1984 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R7
SYMATTR Value 10*{Rvs}
SYMBOL res 1504 2240 R0
SYMATTR InstName R10
SYMATTR Value 10*{Rvs}
SYMBOL OpAmps\\opamp2 1664 2016 R0
SYMATTR InstName U1
SYMBOL res 1072 1296 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 5*{Rtilde}
SYMBOL OpAmps\\opamp2 1264 1392 M180
SYMATTR InstName U2
SYMBOL OpAmps\\opamp2 1264 1584 M180
SYMATTR InstName U3
SYMBOL res 1088 1344 R0
SYMATTR InstName R13
SYMATTR Value {Rtilde}
SYMBOL res 1088 1520 R0
SYMATTR InstName R14
SYMATTR Value 4.6*{Rtilde}
SYMBOL res 1072 1488 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 5.44*{Rtilde}
SYMBOL res 1520 1504 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value {Rtilde}
SYMBOL res 1520 1312 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R17
SYMATTR Value {Rtilde}
SYMBOL OpAmps\\opamp2 1680 1408 M180
SYMATTR InstName U4
SYMBOL res 1760 1440 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R18
SYMATTR Value {Rtilde}
SYMBOL res 1632 1616 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R19
SYMATTR Value {Rtilde}
SYMBOL OpAmps\\opamp2 2544 1552 M180
SYMATTR InstName U5
SYMBOL res 2352 1568 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R20
SYMATTR Value {Ra}
SYMBOL res 2352 1408 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R21
SYMATTR Value Ra * Rtilde/2
SYMBOL res 2528 1344 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R22
SYMATTR Value {Rb}
SYMBOL res 2624 1568 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R23
SYMATTR Value {Rb}
SYMBOL res 2800 1472 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R24
SYMBOL npn 2816 1440 R0
SYMATTR InstName Q7
SYMBOL res 2896 1680 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R25
SYMBOL voltage 2752 1888 R0
SYMATTR InstName V3
SYMATTR Value 5
SYMBOL voltage 2928 1888 R0
SYMATTR InstName V4
SYMATTR Value -5
TEXT -240 560 Left 2 !.op
TEXT -248 624 Left 2 !.param VINDC=6.35
TEXT -248 664 Left 2 !.param VINAC 1
TEXT 80 624 Left 2 !.param VREFDC 1.2
TEXT 80 664 Left 2 !.param VREFAC 0
TEXT 424 624 Left 2 !.param RL 100
TEXT -248 712 Left 2 !;dc VIN 4 24
TEXT 832 664 Left 2 !;step param RE 1k 1.5k 100
TEXT 832 624 Left 2 !.param RE 470
TEXT 416 664 Left 2 !;step param RL 1k 5 10
TEXT 2080 -16 Left 2 ;Mido regulacion de linea
TEXT 2080 24 Left 2 !.meas DC Vo1rl FIND V(Vo) AT=12
TEXT 2080 48 Left 2 !.meas DC Vo2rl FIND V(Vo) AT=24
TEXT 2080 72 Left 2 !.meas DC RegLin PARAM ((Vo2rl-Vo1rl)/12)
TEXT 2080 128 Left 2 ;Mido regulacion de carga
TEXT 2080 168 Left 2 !.meas OP Vo1rc FIND V(Vo) AT 100
TEXT 2080 192 Left 2 !.meas OP Vo2rc FIND V(Vo) AT 5
TEXT 2080 216 Left 2 !.meas OP Io1rc FIND I(RL) AT 100
TEXT 2080 240 Left 2 !.meas OP Io2rc FIND I(RL) AT 5
TEXT 2088 304 Left 2 ;Mido eficiencia
TEXT 2088 344 Left 2 ;-100*((V(vo)*I(RL))/(V(VIN)*I(VIN)))
TEXT 2080 264 Left 2 !.meas OP RegCar PARAM (-(Vo2rc-Vo1rc)/(Io2rc-Io1rc))
TEXT 1272 616 Left 2 !.step param Vllave list 0 6
TEXT 1064 1168 Left 2 ;//porque usamos un seguidor en vez de poner el divisor directo a la entrada
TEXT 1320 896 Left 2 !.step param Rtilde 1k 5 10
TEXT 1304 992 Left 2 !;param Rtilde 1k
TEXT 1912 1832 Left 2 !.param Rvs 1k
TEXT 848 1208 Left 2 ;//R17 y 16 no son Rtilde, deben ser grandes para no cargar. Despues estan en paralelo para definir R21.
