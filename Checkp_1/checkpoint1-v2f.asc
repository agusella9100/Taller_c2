Version 4
SHEET 1 6000 2436
WIRE 96 -32 -240 -32
WIRE 320 -32 96 -32
WIRE 640 -32 320 -32
WIRE 784 -32 736 -32
WIRE 1024 -32 1024 -192
WIRE 1024 -32 784 -32
WIRE 1072 -32 1024 -32
WIRE 1232 -32 1232 -192
WIRE 1232 -32 1152 -32
WIRE 1472 -32 1232 -32
WIRE 1840 -32 1472 -32
WIRE 2000 -32 1840 -32
WIRE 1472 16 1472 -32
WIRE 208 96 160 96
WIRE 256 96 208 96
WIRE 1472 112 1472 96
WIRE 1472 112 1392 112
WIRE 1776 112 1712 112
WIRE 688 128 688 32
WIRE 784 128 784 -32
WIRE 1472 144 1472 112
WIRE -240 176 -240 -32
WIRE 96 176 96 144
WIRE 208 176 208 96
WIRE 208 176 96 176
WIRE 320 208 320 144
WIRE 736 208 736 192
WIRE 736 208 320 208
WIRE 928 208 736 208
WIRE 96 304 96 176
WIRE 320 304 320 208
WIRE 1840 304 1840 -32
WIRE 2000 304 2000 -32
WIRE 1472 320 1472 224
WIRE 1600 320 1472 320
WIRE 1712 320 1712 112
WIRE -32 352 -144 352
WIRE 32 352 -32 352
WIRE 784 352 384 352
WIRE 1392 352 1392 112
WIRE 1392 352 784 352
WIRE -32 400 -32 352
WIRE 1712 400 1648 400
WIRE 1472 416 1472 320
WIRE 96 432 96 400
WIRE 208 432 96 432
WIRE 320 432 320 400
WIRE 320 432 208 432
WIRE 208 464 208 432
WIRE 1712 496 1712 400
WIRE -240 576 -240 256
WIRE -32 576 -32 480
WIRE -32 576 -240 576
WIRE 208 576 208 544
WIRE 208 576 -32 576
WIRE 1472 576 1472 496
WIRE 1472 576 208 576
WIRE 1600 576 1600 416
WIRE 1600 576 1472 576
WIRE 1712 576 1600 576
WIRE 1840 576 1840 384
WIRE 1840 576 1712 576
WIRE 2000 576 2000 368
WIRE 2000 576 1840 576
WIRE 1424 720 1168 720
WIRE 1024 848 928 848
WIRE 1168 848 1168 800
WIRE 1168 848 1104 848
WIRE 1248 848 1168 848
WIRE 1248 896 1248 848
WIRE 1280 896 1248 896
WIRE 1424 912 1424 720
WIRE 1424 912 1344 912
WIRE 1632 912 1424 912
WIRE 1280 928 1248 928
WIRE 1024 976 928 976
WIRE 1168 976 1104 976
WIRE 1248 976 1248 928
WIRE 1248 976 1168 976
WIRE 2352 976 2352 960
WIRE 1904 992 1856 992
WIRE 2048 992 1984 992
WIRE -144 1008 -144 352
WIRE 848 1008 -144 1008
WIRE 2048 1008 2048 992
WIRE 1632 1056 1632 912
WIRE 1728 1056 1632 1056
WIRE 1856 1056 1856 992
WIRE 1856 1056 1808 1056
WIRE 1904 1056 1856 1056
WIRE 2352 1072 2352 976
WIRE 1168 1088 1168 976
WIRE 1904 1104 1904 1056
WIRE 1984 1104 1904 1104
WIRE 2128 1120 2048 1120
WIRE 2176 1120 2128 1120
WIRE 2288 1120 2256 1120
WIRE 1984 1136 1904 1136
WIRE 1648 1216 1632 1216
WIRE 1728 1216 1648 1216
WIRE 1904 1216 1904 1136
WIRE 1904 1216 1808 1216
WIRE 2000 1216 1904 1216
WIRE 2128 1216 2128 1120
WIRE 2128 1216 2080 1216
WIRE 2352 1216 2352 1168
WIRE 496 1248 496 1200
WIRE 672 1248 672 1200
WIRE 1168 1248 1168 1168
WIRE 1216 1248 1168 1248
WIRE 2352 1328 2352 1296
WIRE 848 1360 848 1008
WIRE 976 1360 848 1360
WIRE 1104 1360 1056 1360
WIRE 1232 1360 1104 1360
WIRE 1344 1376 1296 1376
WIRE 1424 1376 1344 1376
WIRE 1552 1376 1504 1376
WIRE 1648 1376 1648 1216
WIRE 1648 1376 1552 1376
WIRE 496 1392 496 1328
WIRE 672 1392 672 1328
WIRE 1232 1392 1200 1392
WIRE 1104 1408 1104 1360
WIRE 1200 1456 1200 1392
WIRE 1344 1456 1344 1376
WIRE 1344 1456 1200 1456
WIRE 784 1552 784 352
WIRE 848 1552 784 1552
WIRE 976 1552 848 1552
WIRE 1104 1552 1056 1552
WIRE 1232 1552 1104 1552
WIRE 1360 1568 1296 1568
WIRE 1424 1568 1360 1568
WIRE 1552 1568 1552 1376
WIRE 1552 1568 1504 1568
WIRE 1104 1584 1104 1552
WIRE 1232 1584 1200 1584
WIRE 1200 1648 1200 1584
WIRE 1360 1648 1360 1568
WIRE 1360 1648 1200 1648
FLAG 208 576 0
FLAG 1840 -32 Vo
FLAG -32 352 Vref
FLAG -240 -32 VIN
FLAG 1392 112 Vf
FLAG 1776 192 0
FLAG 1232 -192 Vs-
FLAG 1024 -192 Vs+
FLAG 928 848 Vs-
FLAG 928 976 Vs+
FLAG 1216 1248 0
FLAG 1104 1488 0
FLAG 1104 1664 0
FLAG 848 1360 Vref
FLAG 848 1552 Vf
FLAG 1648 1376 Vref-c
FLAG 2048 1008 0
FLAG 2352 1328 0
FLAG 1632 1216 Vref-c
FLAG 2352 976 Verror
FLAG 928 208 Verror
FLAG 496 1392 0
FLAG 496 1200 V+
FLAG 672 1200 V-
FLAG 672 1392 0
FLAG 1312 944 V+
FLAG 2016 1152 V+
FLAG 1264 1408 V+
FLAG 1264 1536 V+
FLAG 1312 880 V-
FLAG 2016 1088 V-
FLAG 1264 1600 V-
FLAG 1264 1344 V-
DATAFLAG 1680 -32 ""
DATAFLAG 624 352 ""
SYMBOL pnp 160 144 R180
SYMATTR InstName Q1
SYMATTR Value BC557C
SYMBOL pnp 256 144 M180
SYMATTR InstName Q2
SYMATTR Value BC557C
SYMBOL npn 32 304 R0
SYMATTR InstName Q3
SYMATTR Value BC547C
SYMBOL npn 384 304 M0
SYMATTR InstName Q4
SYMATTR Value BC547C
SYMBOL res 192 448 R0
SYMATTR InstName R1
SYMATTR Value 500
SYMBOL pnp 736 32 M270
SYMATTR InstName 2SB772
SYMATTR Value 2SB772
SYMBOL npn 688 192 R270
SYMATTR InstName Q6
SYMATTR Value 2N4401
SYMBOL res 1456 0 R0
WINDOW 0 44 33 Left 2
WINDOW 3 38 73 Left 2
SYMATTR InstName R5
SYMATTR Value 10.47k
SYMBOL res 1456 128 R0
SYMATTR InstName R6
SYMATTR Value 3.3k
SYMBOL res 1824 288 R0
SYMATTR InstName RL
SYMATTR Value {RL}
SYMBOL voltage -32 384 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 0
SYMATTR Value2 AC {VREFAC}
SYMATTR InstName V1
SYMATTR Value {VREFDC}
SYMBOL voltage -240 160 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 0
SYMATTR Value2 AC {VINAC}
SYMATTR InstName VIN
SYMATTR Value {VINDC}
SYMBOL res 80 -48 R0
SYMATTR InstName R8
SYMATTR Value {RE}
SYMBOL res 304 -48 R0
SYMATTR InstName R9
SYMATTR Value {RE}
SYMBOL cap 1984 304 R0
SYMATTR InstName C3
SYMATTR Value 1µ
SYMBOL res 1456 400 R0
SYMATTR InstName R88
SYMATTR Value 2.7k
SYMBOL nmos 1648 320 M0
SYMATTR InstName M1
SYMATTR Value IPT004N03L
SYMBOL res 1696 480 R0
SYMATTR InstName R11
SYMATTR Value 10k
SYMBOL res 1696 304 R0
SYMATTR InstName R99
SYMATTR Value 10k
SYMBOL voltage 1776 96 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value {Vllave}
SYMBOL res 1168 -48 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 0.1
SYMBOL res 1008 992 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R3
SYMATTR Value {Rvs}
SYMBOL res 1120 832 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value {Rvs}
SYMBOL res 1184 816 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R7
SYMATTR Value {10* Rvs}
SYMBOL res 1152 1072 R0
SYMATTR InstName R10
SYMATTR Value {10*Rvs}
SYMBOL res 1072 1344 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value {5*Rtilde}
SYMBOL res 1088 1392 R0
SYMATTR InstName R13
SYMATTR Value {Rtilde}
SYMBOL res 1088 1568 R0
WINDOW 3 29 66 Left 2
SYMATTR InstName R14
SYMATTR Value {4.6*Rtilde}
SYMBOL res 1072 1536 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value {5.44*Rtilde}
SYMBOL res 1520 1552 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value {R_difer}
SYMBOL res 1520 1360 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R17
SYMATTR Value {R_difer}
SYMBOL res 1824 1200 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R20
SYMATTR Value {Ra}
SYMBOL res 1824 1040 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R21
SYMATTR Value {Ra + R_difer/2}
SYMBOL res 2000 976 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R22
SYMATTR Value {Rb}
SYMBOL res 2096 1200 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R23
SYMATTR Value {Rb}
SYMBOL res 2272 1104 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R24
SYMATTR Value {R_chups}
SYMBOL npn 2288 1072 R0
SYMATTR InstName Q7
SYMATTR Value 2N2222
SYMBOL res 2368 1312 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R25
SYMATTR Value {R_chups}
SYMBOL voltage 496 1232 R0
SYMATTR InstName V3
SYMATTR Value 5
SYMBOL voltage 672 1232 R0
SYMATTR InstName V4
SYMATTR Value -5
SYMBOL OpAmps\\UniversalOpAmp2 1312 912 R0
SYMATTR InstName U1
SYMBOL OpAmps\\UniversalOpAmp2 1264 1376 R0
SYMATTR InstName U2
SYMBOL OpAmps\\UniversalOpAmp2 1264 1568 R0
WINDOW 0 60 -26 Left 2
SYMATTR InstName U3
SYMBOL OpAmps\\UniversalOpAmp2 2016 1120 M180
SYMATTR InstName U4
TEXT -240 560 Left 2 !.op
TEXT -248 624 Left 2 !.param VINDC=6.35
TEXT -248 664 Left 2 !.param VINAC 1
TEXT 80 624 Left 2 !.param VREFDC 1.2
TEXT 80 664 Left 2 !.param VREFAC 0
TEXT 424 624 Left 2 !;param RL 100
TEXT -248 712 Left 2 !;dc VIN 4 24
TEXT 832 664 Left 2 !;step param RE 1k 1.5k 100
TEXT 832 624 Left 2 !.param RE 470
TEXT 416 664 Left 2 !.step param RL 1k 5 10
TEXT 2080 -16 Left 2 ;Mido regulacion de linea
TEXT 2080 24 Left 2 !.meas DC Vo1rl FIND V(Vo) AT=12
TEXT 2080 48 Left 2 !.meas DC Vo2rl FIND V(Vo) AT=24
TEXT 2080 72 Left 2 !.meas DC RegLin PARAM ((Vo2rl-Vo1rl)/12)
TEXT 2080 128 Left 2 ;Mido regulacion de carga
TEXT 2080 168 Left 2 !.meas OP Vo1rc FIND V(Vo) AT 100
TEXT 2080 192 Left 2 !.meas OP Vo2rc FIND V(Vo) AT 5
TEXT 2080 216 Left 2 !.meas OP Io1rc FIND I(RL) AT 100
TEXT 2080 240 Left 2 !.meas OP Io2rc FIND I(RL) AT 5
TEXT 2088 304 Left 2 ;Mido eficiencia
TEXT 2088 344 Left 2 ;-100*((V(vo)*I(RL))/(V(VIN)*I(VIN)))
TEXT 2080 264 Left 2 !.meas OP RegCar PARAM (-(Vo2rc-Vo1rc)/(Io2rc-Io1rc))
TEXT 1272 616 Left 2 !.step param Vllave list 0 6
TEXT -1112 824 Left 2 ;//porque usamos un seguidor en vez de poner el divisor directo a la entrada
TEXT -1328 864 Left 2 ;//R17 y 16 no son Rtilde, deben ser grandes para no cargar. Despues estan en paralelo para definir R21.
TEXT -560 1088 Left 2 !.param Rtilde 1K
TEXT -560 1136 Left 2 !.param Ra 100
TEXT -560 1168 Left 2 !.param R_difer 820
TEXT -560 1216 Left 2 !.param Rvs 1K
TEXT 240 -480 Left 2 !.model 2SB772 PNP(Is=282f Xti=3 Eg=1.11 Vaf=100 Bf=213.6 Ise=1.659p Ne=1.787 Ikf=6.472 Nk=.7894 Xtb=1.5 Var=100 Br=39.18 Isc=12.72p Nc=1.637 Ikr=.1652 Rc=64.89m Cjc=145.6p Mjc=.2985 Vjc=.3905 Fc=.5 Cje=255.3p Mje=.5064 Vje=1.615 Itf=6.218 Xtf=0 Vtf=10)
TEXT -552 1256 Left 2 !.param Rb 5.1K
TEXT -552 1312 Left 2 !.param R_chups 520
TEXT -8 -256 Left 2 !.model 2SB772 PNP(Is=282f Xti=3 Eg=1.11 Vaf=100 Bf=213.6 Ise=1.659p Ne=1.787 Ikf=6.472 Nk=.7894 Xtb=1.5 Var=100 Br=39.18 Isc=12.72p Nc=1.637 Ikr=.1652 Rc=64.89m Cjc=145.6p Mjc=.2985 Vjc=.3905 Fc=.5 Cje=255.3p Mje=.5064 Vje=1.615 Tr=10n Tf=1.927n Itf=6.218 Xtf=0 Vtf=10)
